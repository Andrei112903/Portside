<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PortSide - Menu Management</title>
    <link rel="stylesheet" href="/src/style.css">
</head>

<body>
    <div id="menu-app">
        <div class="dashboard-layout">
            <aside class="dash-sidebar">
                <div class="dash-brand">PortSide Admin</div>
                <nav class="dash-nav">
                    <a href="/dashboard.html" class="dash-link">Overview</a>
                    <a href="/stocks.html" class="dash-link">Stock Management</a>
                    <a href="/expenses.html" class="dash-link">Daily Expenses</a>
                    <a href="/reports.html" class="dash-link">Sales Reports</a>
                    <a href="/menu.html" class="dash-link active">Menu Management</a>
                    <a href="/kitchen.html" class="dash-link" style="color:#fbbf24; font-weight:700;">üë®‚Äçüç≥ Kitchen
                        View</a>
                    <a href="/staff.html" class="dash-link">Staff</a>
                    <a href="/settings.html" class="dash-link">Settings</a>
                    <div class="dash-divider"></div>
                    <a href="/" class="dash-link">üñ•Ô∏è Open POS</a>
                    <a href="/login.html" class="dash-link logout">Logout</a>
                </nav>
            </aside>

            <main class="dash-main">
                <header class="dash-header">
                    <h2>Menu Management</h2>
                    <div class="user-profile">Admin User</div>
                </header>

                <div class="stock-controls">
                    <div class="filter-group">
                        <select id="categoryFilter" class="category-select">
                            <option value="all">All Categories</option>
                            <option value="starters">Starters</option>
                            <option value="mains">Mains</option>
                            <option value="drinks">Drinks</option>
                        </select>
                    </div>
                    <button class="btn-success" onclick="openMenuModal()">+ Add New Item</button>
                </div>

                <div class="recent-orders-section">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Item Name</th>
                                <th>Category</th>
                                <th>Price</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="menuTableBody">
                            <!-- JS Injected -->
                        </tbody>
                    </table>
                </div>
            </main>
        </div>
    </div>

    <!-- Menu Modal -->
    <div id="menuModal" class="stock-modal">
        <div class="modal-content">
            <h2 style="margin-bottom: 1.5rem; color:white;" id="modalTitle">Add Menu Item</h2>
            <form id="menuForm">
                <input type="hidden" id="itemId">
                <input type="hidden" id="originalInfo"> <!-- Store original cat/id for edit -->

                <div class="form-group">
                    <label>Item Name</label>
                    <input type="text" id="itemName" required>
                </div>

                <div class="form-group">
                    <label>Category</label>
                    <select id="itemCategory" class="category-select" style="width:100%" required>
                        <option value="starters">Starters</option>
                        <option value="mains">Mains</option>
                        <option value="drinks">Drinks</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>Price (‚Ç±)</label>
                    <input type="number" step="0.01" id="itemPrice" required>
                </div>

                <div style="display: flex; gap: 1rem; margin-top: 2rem;">
                    <button type="button" class="btn-danger" style="flex:1" onclick="closeMenuModal()">Cancel</button>
                    <button type="submit" class="btn-success" style="flex:1">Save Item</button>
                </div>
            </form>
        </div>
    </div>

    <script type="module" src="/src/main.js"></script>
    <script type="module">
        const modal = document.getElementById('menuModal');
        const form = document.getElementById('menuForm');
        const tableBody = document.getElementById('menuTableBody');
        const filter = document.getElementById('categoryFilter');

        function getMenu() {
            return JSON.parse(localStorage.getItem('menuData')) || { starters: [], mains: [], drinks: [] };
        }

        function saveMenu(data) {
            localStorage.setItem('menuData', JSON.stringify(data));
            render();
        }

        function render() {
            const menu = getMenu();
            const catFilter = filter.value;
            let items = [];

            // Flatten menu object into array for display
            Object.keys(menu).forEach(cat => {
                if (catFilter === 'all' || catFilter === cat) {
                    menu[cat].forEach(item => {
                        items.push({ ...item, category: cat });
                    });
                }
            });

            if (items.length === 0) {
                tableBody.innerHTML = '<tr><td colspan="4" style="text-align:center; padding:2rem;">No items found.</td></tr>';
                return;
            }

            tableBody.innerHTML = items.map(item => `
                <tr>
                    <td style="font-weight:600">${item.name}</td>
                    <td><span class="badge" style="background:rgba(255,255,255,0.05); text-transform:capitalize;">${item.category}</span></td>
                    <td style="font-weight:700; color:var(--color-success)">‚Ç±${item.price.toFixed(2)}</td>
                    <td>
                        <button class="btn-icon" onclick="window.editItem(${item.id}, '${item.category}')" style="background:rgba(56,189,248,0.1); color:var(--color-accent)">‚úèÔ∏è</button>
                        <button class="btn-icon" onclick="window.deleteItem(${item.id}, '${item.category}')" style="background:rgba(239,68,68,0.1); color:var(--color-danger)">üóëÔ∏è</button>
                    </td>
                </tr>
            `).join('');
        }

        window.openMenuModal = () => {
            form.reset();
            document.getElementById('itemId').value = '';
            document.getElementById('originalInfo').value = '';
            document.getElementById('modalTitle').textContent = 'Add Menu Item';
            modal.classList.add('active');
        };

        window.closeMenuModal = () => {
            modal.classList.remove('active');
        };

        window.editItem = (id, category) => {
            const menu = getMenu();
            const item = menu[category].find(i => i.id === id);
            if (!item) return;

            document.getElementById('itemId').value = item.id;
            document.getElementById('itemName').value = item.name;
            document.getElementById('itemCategory').value = category;
            document.getElementById('itemPrice').value = item.price;
            document.getElementById('originalInfo').value = JSON.stringify({ id, category });

            document.getElementById('modalTitle').textContent = 'Edit Menu Item';
            modal.classList.add('active');
        };

        window.deleteItem = (id, category) => {
            if (confirm('Delete this item?')) {
                const menu = getMenu();
                menu[category] = menu[category].filter(i => i.id !== id);
                saveMenu(menu);
            }
        };

        form.onsubmit = (e) => {
            e.preventDefault();
            const id = document.getElementById('itemId').value;
            const originalInfoStr = document.getElementById('originalInfo').value;

            const name = document.getElementById('itemName').value;
            const category = document.getElementById('itemCategory').value;
            const price = parseFloat(document.getElementById('itemPrice').value);

            const menu = getMenu();

            if (originalInfoStr) {
                // Edit
                const original = JSON.parse(originalInfoStr);

                // Remove from old category
                menu[original.category] = menu[original.category].filter(i => i.id !== original.id);

                // Add to new (or same) category
                const updatedItem = { id: parseInt(id), name, price };
                if (!menu[category]) menu[category] = [];
                menu[category].push(updatedItem);

            } else {
                // Add
                const newItem = { id: Date.now(), name, price };
                if (!menu[category]) menu[category] = [];
                menu[category].push(newItem);
            }

            saveMenu(menu);
            closeMenuModal();
        };

        filter.addEventListener('change', render);
        render();
    </script>
</body>

</html>